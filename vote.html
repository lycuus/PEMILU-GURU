<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOTE PAGE - OSSIP 2026</title>
    <link rel="icon" type="image/png" href="assets/ossip-bg.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>

        /* Fallback for broken images */
img[src*="kandidat"]:before {
    content: " ";
    display: block;
    background: #f0f0f0;
    height: 100%;
    width: 100%;
}

/* Loading state for candidates */
.loading-candidates {
    text-align: center;
    padding: 40px;
    color: #7f8c8d;
}

.loading-candidates i {
    font-size: 48px;
    margin-bottom: 15px;
    color: #3498db;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 0.5; }
    50% { opacity: 1; }
    100% { opacity: 0.5; }
}

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Logo Styles */
        .logo-container {
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #e3f2fd;
        }

        .logo-image {
            height: 40px;
            width: auto;
            max-width: 100%;
            transition: transform 0.3s ease;
        }

        .logo-image:hover {
            transform: scale(1.05);
        }

        /* Header */
        .vote-header {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 12px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .vote-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .vote-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vote-logo img {
            height: 45px;
            filter: brightness(0) invert(1);
        }

        .vote-logo h1 {
            font-size: 18px;
            font-weight: 700;
        }

        .vote-logo p {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 2px;
        }

        /* User Info */
        .vote-user-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 280px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info i {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.95);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        #currentUser {
            font-weight: 600;
            font-size: 14px;
        }

        #currentUserClass {
            font-size: 12px;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 20px;
            margin-top: 3px;
            display: inline-block;
        }

        .btn-logout {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* Main Content */
        .vote-main {
            padding: 20px 0;
        }

        /* Instructions */
        .vote-instructions {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #3498db;
        }

        .instruction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .instruction-header i {
            color: #3498db;
            font-size: 20px;
        }

        .instruction-header h2 {
            color: #2c3e50;
            font-size: 18px;
        }

        .instruction-steps {
            padding-left: 20px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .instruction-steps li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .warning-box {
            background: #fff8e1;
            border-left: 3px solid #ffc107;
            padding: 12px;
            border-radius: 5px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .warning-box i {
            color: #ff9800;
            font-size: 18px;
            margin-top: 1px;
        }

        .warning-box p {
            color: #5d4037;
            font-size: 13px;
        }

        /* Gender Selection */
        .gender-selection {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .gender-selection h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .gender-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .gender-tab {
            padding: 10px 20px;
            border: 2px solid #3498db;
            border-radius: 6px;
            background: white;
            color: #3498db;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gender-tab:hover {
            background: #f0f8ff;
        }

        .gender-tab.active {
            background: #3498db;
            color: white;
        }

        /* Candidates Section */
        .vote-candidates {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .vote-title {
            text-align: center;
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 8px;
        }

        .vote-subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .vote-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Vote Card */
        .vote-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .vote-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: #3498db;
        }

        .card-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .gender-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }

        .gender-badge.ikhwan {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .gender-badge.akhwat {
            background: linear-gradient(135deg, #E91E63, #C2185B);
            color: white;
        }

        .card-avatar {
            text-align: center;
            margin-bottom: 15px;
        }

        .card-avatar img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f1f8ff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .avatar-label {
            display: block;
            margin-top: 6px;
            color: #7f8c8d;
            font-size: 13px;
            font-weight: 500;
        }

        .candidate-name {
            text-align: center;
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .info-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .info-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        .info-icon {
            color: #3498db;
            width: 18px;
            font-size: 14px;
        }

        .info-text {
            color: #555;
            font-size: 14px;
        }

        .vision-box {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 3px solid #3498db;
        }

        .vision-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2c3e50;
            font-size: 15px;
            margin-bottom: 12px;
        }

        .vision-title i {
            color: #3498db;
        }

        .vision-text {
            color: #555;
            line-height: 1.5;
            font-size: 13px;
        }

        /* Vote Button */
        .vote-btn {
            width: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .vote-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #219653 0%, #1e8449 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
        }

        .vote-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .selected-indicator {
            position: absolute;
            top: 40px;
            right: 12px;
            background: #27ae60;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        /* Selection Summary */
        .selection-summary {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .summary-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .summary-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .summary-card {
            flex: 1;
            min-width: 220px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .summary-card h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
        }

        .summary-card p {
            color: #555;
            margin: 4px 0;
            font-size: 14px;
        }

        /* Submit Button */
        .btn-submit {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin: 15px auto 0;
            min-width: 180px;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-submit:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Confirmation Details */
        .voter-details-confirm {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 3px solid #3498db;
        }

        .voter-details-confirm h4 {
            margin: 0 0 12px 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .voter-details-confirm p {
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555;
            font-size: 14px;
        }

        .voter-details-confirm i {
            color: #3498db;
            width: 18px;
            text-align: center;
        }

        .confirmation-warning {
            background: #fff8e1;
            border-left: 3px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .confirmation-warning i {
            color: #ff9800;
            font-size: 18px;
            margin-top: 1px;
        }

        .confirmation-warning p {
            color: #5d4037;
            line-height: 1.5;
            font-size: 14px;
        }

        /* Selected Candidates Info */
        .selected-candidates {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .selected-candidate-card {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #bbdefb;
        }

        .selected-candidate-card h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
        }

        .selected-candidate-card p {
            margin: 4px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #555;
            font-size: 13px;
        }

        .selected-candidate-card i {
            color: #3498db;
            width: 14px;
        }

        /* Success Modal */
        .success-modal {
            text-align: center;
            padding: 25px;
        }

        .modal-icon {
            font-size: 60px;
            color: #27ae60;
            margin-bottom: 20px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .success-modal h2 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 20px;
        }

        .success-modal > p {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .success-details {
            text-align: left;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .success-details p {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            font-size: 14px;
        }

        .success-details i {
            color: #27ae60;
            width: 18px;
        }

        /* Buttons */
        .btn-cancel, .btn-confirm, .btn-finish {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
            font-size: 14px;
        }

        .btn-cancel {
            background: #e74c3c;
            color: white;
        }

        .btn-cancel:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
        }

        .btn-confirm {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-confirm:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f639c 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .btn-finish {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
            min-width: 180px;
            margin: 15px auto 0;
        }

        .btn-finish:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        /* Footer */
        .vote-footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 15px 0;
            margin-top: 30px;
            font-size: 13px;
        }

        .vote-footer p {
            margin: 6px 0;
            opacity: 0.9;
        }

        .vote-footer i {
            color: #3498db;
            margin-right: 6px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .vote-header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .vote-user-info {
                flex-direction: column;
                gap: 10px;
                min-width: auto;
                width: 100%;
            }
            
            .vote-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .gender-tabs {
                width: 100%;
            }
            
            .gender-tab {
                flex: 1;
                padding: 10px;
                font-size: 13px;
            }
            
            .vote-card {
                padding: 15px;
            }
            
            .candidate-name {
                font-size: 16px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .btn-cancel, .btn-confirm {
                width: 100%;
            }
            
            .summary-cards {
                flex-direction: column;
            }
            
            .summary-card {
                min-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .vote-logo h1 {
                font-size: 16px;
            }
            
            .vote-title {
                font-size: 18px;
            }
            
            .instruction-header h2 {
                font-size: 16px;
            }
            
            .modal-content {
                margin: 5px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .card-avatar img {
                width: 70px;
                height: 70px;
            }
        }
        
        @media (max-width: 360px) {
            .vote-grid {
                grid-template-columns: 1fr;
            }
            
            .gender-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .btn-submit {
                min-width: 160px;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body class="vote-page">
    <header class="vote-header">
        <div class="container">
            <div class="vote-header-content">
                <div class="vote-logo">
                    <div class="logo-container">
                        <img src="assets/logo-ossip.png" alt="Logo OSSIP" class="logo-image" 
                            onerror="this.src='assets/default-logo.png'; this.onerror=null;">
                    </div>
                    <div>
                        <h1>PEMILIHAN OSSIP</h1>
                        <p>2026-2027 | INSAN PRATAMA</p>
                    </div>
                </div>
                <div class="vote-user-info">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <div class="user-details">
                            <span id="currentUser">Memuat data...</span>
                            <span id="currentUserClass" class="user-class"></span>
                        </div>
                    </div>
                    <button class="btn-logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Keluar
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <main class="vote-main">
        <div class="container">
            <div class="vote-instructions">
                <div class="instruction-header">
                    <i class="fas fa-info-circle"></i>
                    <h2>Panduan Pemilihan</h2>
                </div>
                <ol class="instruction-steps">
                    <li>Pilih <strong>satu pasangan ketua Ikhwan</strong> dan <strong>satu pasangan ketua Akhwat</strong>.</li>
                    <li>Klik tombol "PILIH" pada kandidat yang Anda pilih di masing-masing kategori.</li>
                    <li>Setelah memilih kedua kandidat, klik tombol "SUBMIT SUARA" untuk mengirimkan.</li>
                    <li>Setelah mengirimkan, Anda <strong>tidak dapat mengganti</strong> pilihan.</li>
                    <li>Hasil pemilihan akan dimulai pada 24 Januari 2026.</li>
                </ol>
                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Anda harus memilih <strong>satu Ikhwan dan satu Akhwat</strong>. Pastikan pilihan Anda sudah tepat sebelum mengkonfirmasi.</p>
                </div>
            </div>

            <!-- Gender Selection Tabs -->
            <div class="gender-selection">
                <h3>Pilih Kategori Kandidat</h3>
                <div class="gender-tabs">
                    <button class="gender-tab active" data-gender="ikhwan">
                        <i class="fas fa-male"></i> Kandidat Ikhwan
                    </button>
                    <button class="gender-tab" data-gender="akhwat">
                        <i class="fas fa-female"></i> Kandidat Akhwat
                    </button>
                </div>
            </div>
            
            <!-- Ikhwan Candidates -->
            <div class="vote-candidates" id="ikhwanCandidates" style="display: block;">
                <h2 class="vote-title">PILIH CALON KETUA OSSIP (IKHWAN)</h2>
                <p class="vote-subtitle">Pilih satu dari tiga kandidat ikhwan</p>
                
                <div class="vote-grid" id="ikhwanGrid">
                    <!-- Kandidat ikhwan akan di-load oleh JavaScript -->
                </div>
            </div>
            
            <!-- Akhwat Candidates -->
            <div class="vote-candidates" id="akhwatCandidates" style="display: none;">
                <h2 class="vote-title">PILIH CALON KETUA OSSIP (AKHWAT)</h2>
                <p class="vote-subtitle">Pilih satu dari tiga kandidat akhwat</p>
                
                <div class="vote-grid" id="akhwatGrid">
                    <!-- Kandidat akhwat akan di-load oleh JavaScript -->
                </div>
            </div>
            
            <!-- Selection Summary -->
            <div class="selection-summary" id="selectionSummary">
                <div class="summary-title">
                    <i class="fas fa-clipboard-check"></i>
                    <h3>Ringkasan Pilihan Anda</h3>
                </div>
                <div class="summary-cards">
                    <div class="summary-card">
                        <h4><i class="fas fa-male"></i> Pilihan Ikhwan</h4>
                        <p id="selectedIkhwan">Belum memilih</p>
                    </div>
                    <div class="summary-card">
                        <h4><i class="fas fa-female"></i> Pilihan Akhwat</h4>
                        <p id="selectedAkhwat">Belum memilih</p>
                    </div>
                </div>
                <button class="btn-submit" id="submitVote">
                    <i class="fas fa-paper-plane"></i> SUBMIT SUARA
                </button>
            </div>
            
            <!-- Konfirmasi Modal -->
            <div class="modal-overlay" id="confirmModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-exclamation-circle"></i> Konfirmasi Pilihan Anda</h2>
                        <button class="modal-close" id="closeModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- Informasi Pemilih -->
                        <div class="voter-details-confirm">
                            <h4><i class="fas fa-user-check"></i> Data Pemilih</h4>
                            <p><i class="fas fa-user"></i> <strong>Nama:</strong> <span id="voterNameConfirm">-</span></p>
                            <p><i class="fas fa-id-card"></i> <strong>Username:</strong> <span id="voterUsernameConfirm">-</span></p>
                            <p><i class="fas fa-graduation-cap"></i> <strong>Kelas:</strong> <span id="voterClassConfirm">-</span></p>
                        </div>
                        
                        <div class="confirmation-details">
                            <div class="selected-candidates" id="selectedCandidatesInfo">
                                <!-- Informasi kandidat akan diisi oleh JavaScript -->
                            </div>
                            <div class="confirmation-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <p>Setelah dikonfirmasi, pilihan <strong>tidak dapat diubah</strong>. Pastikan pilihan Anda sudah tepat.</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-cancel" id="cancelVote">
                            <i class="fas fa-times"></i> Batal
                        </button>
                        <button class="btn-confirm" id="confirmVote">
                            <i class="fas fa-check"></i> YA, KONFIRMASI PILIHAN
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Success Modal -->
            <div class="modal-overlay" id="successModal">
                <div class="modal-content success-modal">
                    <div class="modal-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>SUARA ANDA TELAH TERKIRIM!</h2>
                    <p>Terima kasih telah berpartisipasi dalam Pemilu OSSIP 2026-2027. Suara Anda sangat berharga untuk menentukan masa depan organisasi siswa di sekolah kita.</p>
                    
                    <div class="success-details">
                        <p><i class="fas fa-user"></i> <strong>Nama Pemilih:</strong> <span id="voterNameSuccess">-</span></p>
                        <p><i class="fas fa-id-card"></i> <strong>Username:</strong> <span id="voterUsernameSuccess">-</span></p>
                        <p><i class="fas fa-clock"></i> <strong>Waktu:</strong> <span id="voteTimeSuccess">-</span></p>
                        <p><i class="fas fa-male"></i> <strong>Pilihan Ikhwan:</strong> <span id="voteIkhwanSuccess">-</span></p>
                        <p><i class="fas fa-female"></i> <strong>Pilihan Akhwat:</strong> <span id="voteAkhwatSuccess">-</span></p>
                    </div>
                    
                    <button class="btn-finish" id="finishBtn">
                        <i class="fas fa-home"></i> KEMBALI KE BERANDA
                    </button>
                </div>
            </div>

            <!-- Already Voted Modal -->
            <div class="modal-overlay" id="alreadyVotedModal">
                <div class="modal-content success-modal">
                    <div class="modal-icon" style="color: #e74c3c;">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <h2 style="color: #e74c3c;">ANDA SUDAH MEMILIH!</h2>
                    <p>Anda sudah melakukan voting sebelumnya. Setiap siswa hanya dapat memilih satu kali.</p>
                    
                    <div class="success-details">
                        <p><i class="fas fa-user"></i> <strong>Nama Pemilih:</strong> <span id="voterNameAlready">-</span></p>
                        <p><i class="fas fa-id-card"></i> <strong>Username:</strong> <span id="voterUsernameAlready">-</span></p>
                        <p><i class="fas fa-graduation-cap"></i> <strong>Kelas:</strong> <span id="voterClassAlready">-</span></p>
                        <p><i class="fas fa-info-circle"></i> <strong>Status:</strong> Sudah melakukan voting</p>
                    </div>
                    
                    <button class="btn-finish" id="backToHomeBtn" style="background: #e74c3c;">
                        <i class="fas fa-home"></i> KEMBALI KE BERANDA
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="vote-footer">
        <div class="container">
            <p><i class="fas fa-lock"></i> Sistem ini aman dan terenkripsi. Pilihan Anda bersifat rahasia.</p>
            <p>Pemilu OSSIP 2026-2027 | INSAN PRATAMA</p>
        </div>
    </footer>
<script>
document.addEventListener('DOMContentLoaded', async function() {
    console.log("ðŸ—³ï¸ Voting system starting...");
    
    // ============================================
    // VARIABLES
    // ============================================
    let currentVoter = null;
    let candidates = [];
    let selectedIkhwan = null;
    let selectedAkhwat = null;
    let isInitialized = false;
    
    // ============================================
    // 1. LOAD CANDIDATES - SIMPLIFIED
    // ============================================
    async function loadCandidates() {
        console.log("ðŸ”„ Loading candidates...");
        
        // Data kandidat tetap
        candidates = [
            {
                id: 1,
                number: 1,
                gender: 'ikhwan',
                chairman_name: "MUHAMAD FADLAN ARFANI",
                chairman_class: "XI C",
                motto: "Bersama Membangun Prestasi",
                tags: ["#Ganteng", "#Prestasi", "#Loyalitas"],
                vision: "Mewujudkan OSSIP yang inovatif, aspiratif, dan berprestasi di tingkat regional dengan mengedepankan transparansi dan partisipasi aktif seluruh siswa.",
                image_chairman: "assets/kandidat1.jpg",
                votes: 0
            },
            {
                id: 2,
                number: 2,
                gender: 'ikhwan',
                chairman_name: "PRAMUDITA AULADI",
                chairman_class: "XI C",
                motto: "Kreatif, Inovatif, dan Kolaboratif",
                tags: ["#Kreatif", "#Kolaborasi", "#Aspiratif"],
                vision: "Menjadikan OSSIP sebagai wadah pengembangan potensi siswa secara maksimal melalui program kreatif, inovatif, dan kolaboratif dengan seluruh elemen sekolah.",
                image_chairman: "assets/kandidat2.jpg",
                votes: 0
            },
            {
                id: 3,
                number: 3,
                gender: 'ikhwan',
                chairman_name: "DARMA ALIF SAPUTRA",
                chairman_class: "XI D",
                motto: "Satu untuk Semua, Semua untuk Satu",
                tags: ["#Solidaritas", "#Transparan", "#Fleksibel"],
                vision: "Membentuk OSIS yang solid, transparan, dan berorientasi pada kebutuhan siswa dengan mengutamakan prinsip gotong royong dan kebersamaan.",
                image_chairman: "assets/kandidat3.png",
                votes: 0
            },
            {
                id: 4,
                number: 1,
                gender: 'akhwat',
                chairman_name: "AMRELINA",
                chairman_class: "XI B",
                motto: "Kreatif, Inovatif, dan Bertanggung Jawab",
                tags: ["#Kreatif", "#Disiplin", "#AkhlakBaik"],
                vision: "Menjadikan organisasi santri Insan Pratama 2 sebagai organisasi yang aktif, disiplin, dan bertanggung jawab dalam membentuk santri yang berakhlak baik, berprestasi, serta menjunjung tinggi nilai-nilai islam dan budaya pesantren",
                image_chairman: "assets/kandidat4.jpg",
                votes: 0
            },
            {
                id: 5,
                number: 2,
                gender: 'akhwat',
                chairman_name: "KHOLIDAH IZZATI",
                chairman_class: "XI B",
                motto: "Harmonis, Kreatif, dan Bersama",
                tags: ["#Harmonis", "#Kreatif", "#Kebersamaan"],
                vision: "Mewujudkan lingkungan SMA Insan Pratama yang harmonis, kreatif, dan penuh semangat kebersamaan sehingga setiap santri dapat berkembang secara akademik, spiritual, dan sosial",
                image_chairman: "assets/kandidat5.jpg",
                votes: 0
            },
            {
                id: 6,
                number: 3,
                gender: 'akhwat',
                chairman_name: "NAVA AISILA HASNA",
                chairman_class: "XI B",
                motto: "Religius, Aktif, Disiplin, dan Berakhlak Mulia",
                tags: ["#Religius", "#Aktif", "#Disiplin"],
                vision: "Mewujudkan OSSIP Insan Pratama 2 sebagai wadah penggerak santri yang religius, aktif, disiplin, dan berakhlak mulia demi terciptanya lingkungan sekolah yang semakin berprestasi, harmonis, dan beretika",
                image_chairman: "assets/kandidat6.jpg",
                votes: 0
            }
        ];
        
        console.log("âœ… Candidates loaded:", candidates.length);
        renderAllCandidates();
        
        // Coba simpan ke database jika tersedia
        if (window.db && window.db.addCandidate) {
            setTimeout(() => saveCandidatesToDatabase(), 500);
        }
        
        return true;
    }
    
    // ============================================
    // 2. RENDER ALL CANDIDATES
    // ============================================
    function renderAllCandidates() {
        console.log("ðŸŽ¨ Rendering all candidates...");
        renderCandidates('ikhwan');
        renderCandidates('akhwat');
        console.log("âœ… All candidates rendered");
    }
    
    // ============================================
    // 3. RENDER CANDIDATES BY GENDER
    // ============================================
    function renderCandidates(gender) {
        const grid = document.getElementById(gender + 'Grid');
        if (!grid) return;
        
        const genderCandidates = candidates.filter(c => c.gender === gender);
        
        if (genderCandidates.length === 0) {
            grid.innerHTML = `<div style="text-align:center;color:#7f8c8d;padding:40px;grid-column:1/-1;">
                <i class="fas fa-user-slash" style="font-size:48px;margin-bottom:15px;color:#bdc3c7;"></i>
                <h3 style="color:#7f8c8d;margin-bottom:10px;">Belum Ada Kandidat ${gender.toUpperCase()}</h3>
            </div>`;
            return;
        }
        
        grid.innerHTML = '';
        
        genderCandidates.forEach(candidate => {
            const isSelected = (gender === 'ikhwan' && selectedIkhwan === candidate.id) || 
                               (gender === 'akhwat' && selectedAkhwat === candidate.id);
            
            const card = document.createElement('div');
            card.className = 'vote-card';
            card.innerHTML = `
                <div class="card-badge">KANDIDAT ${candidate.number}</div>
                <div class="gender-badge ${gender}">${gender.toUpperCase()}</div>
                
                ${isSelected ? '<div class="selected-indicator"><i class="fas fa-check"></i></div>' : ''}
                
                <div class="card-avatar">
                    <img src="${candidate.image_chairman || 'assets/default-avatar.png'}" 
                         alt="${candidate.chairman_name}"
                         onerror="this.onerror=null; this.src='assets/default-avatar.png'">
                    <span class="avatar-label">Ketua</span>
                </div>
                
                <h4 class="candidate-name">${candidate.chairman_name}</h4>
                
                <div class="tags-container">
                    ${Array.isArray(candidate.tags) ? 
                      candidate.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : 
                      `<span class="tag">${candidate.tags || 'Kandidat'}</span>`}
                </div>
                
                <div class="info-box">
                    <div class="info-row">
                        <i class="fas fa-graduation-cap info-icon"></i>
                        <span class="info-text">${candidate.chairman_class}</span>
                    </div>
                    <div class="info-row">
                        <i class="fas fa-quote-left info-icon"></i>
                        <span class="info-text">"${candidate.motto}"</span>
                    </div>
                </div>
                
                <div class="vision-box">
                    <h4 class="vision-title">
                        <i class="fas fa-bullseye"></i>
                        Visi Utama
                    </h4>
                    <p class="vision-text">${candidate.vision}</p>
                </div>
                
                <button class="vote-btn" 
                        data-candidate-id="${candidate.id}" 
                        data-gender="${gender}"
                        ${isSelected || (currentVoter && currentVoter.has_voted) ? 'disabled' : ''}>
                    <i class="fas fa-check-circle"></i>
                    ${isSelected ? 'DIPILIH' : (currentVoter && currentVoter.has_voted ? 'SUDAH MEMILIH' : 'PILIH KANDIDAT INI')}
                </button>
            `;
            
            grid.appendChild(card);
        });
        
        setupVoteButtons(gender);
    }
    
    // ============================================
    // 4. SETUP VOTE BUTTONS
    // ============================================
    function setupVoteButtons(gender) {
        const buttons = document.querySelectorAll(`#${gender}Grid .vote-btn:not([disabled])`);
        
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                const candidateId = parseInt(this.getAttribute('data-candidate-id'));
                const gender = this.getAttribute('data-gender');
                
                if (!currentVoter) {
                    alert('Silakan login terlebih dahulu.');
                    return;
                }
                
                if (currentVoter.has_voted) {
                    alert('Anda sudah melakukan voting.');
                    return;
                }
                
                console.log(`ðŸŽ¯ Selected ${gender} candidate:`, candidateId);
                
                if (gender === 'ikhwan') {
                    selectedIkhwan = candidateId;
                } else {
                    selectedAkhwat = candidateId;
                }
                
                renderCandidates('ikhwan');
                renderCandidates('akhwat');
                updateSelectionSummary();
                
                const summary = document.getElementById('selectionSummary');
                if (selectedIkhwan && selectedAkhwat) {
                    summary.style.display = 'block';
                    setTimeout(() => {
                        summary.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            });
        });
    }
    
    // ============================================
    // 5. UPDATE SELECTION SUMMARY
    // ============================================
    function updateSelectionSummary() {
        const ikhwanCandidate = candidates.find(c => c.id === selectedIkhwan);
        const akhwatCandidate = candidates.find(c => c.id === selectedAkhwat);
        
        document.getElementById('selectedIkhwan').textContent = 
            ikhwanCandidate ? `Kandidat ${ikhwanCandidate.number}: ${ikhwanCandidate.chairman_name}` : 'Belum memilih';
        
        document.getElementById('selectedAkhwat').textContent = 
            akhwatCandidate ? `Kandidat ${akhwatCandidate.number}: ${akhwatCandidate.chairman_name}` : 'Belum memilih';
    }
    
    // ============================================
    // 6. UPDATE CONFIRMATION MODAL
    // ============================================
    function updateConfirmationModal() {
        const ikhwanCandidate = candidates.find(c => c.id === selectedIkhwan);
        const akhwatCandidate = candidates.find(c => c.id === selectedAkhwat);
        
        document.getElementById('voterNameConfirm').textContent = currentVoter.name;
        document.getElementById('voterUsernameConfirm').textContent = currentVoter.username;
        document.getElementById('voterClassConfirm').textContent = currentVoter.class;
        
        document.getElementById('selectedCandidatesInfo').innerHTML = `
            <div class="selected-candidate-card">
                <h4><i class="fas fa-male"></i> Pilihan Ikhwan</h4>
                <p><i class="fas fa-hashtag"></i> <strong>Nomor:</strong> ${ikhwanCandidate.number}</p>
                <p><i class="fas fa-user"></i> <strong>Nama:</strong> ${ikhwanCandidate.chairman_name}</p>
                <p><i class="fas fa-graduation-cap"></i> <strong>Kelas:</strong> ${ikhwanCandidate.chairman_class}</p>
            </div>
            <div class="selected-candidate-card">
                <h4><i class="fas fa-female"></i> Pilihan Akhwat</h4>
                <p><i class="fas fa-hashtag"></i> <strong>Nomor:</strong> ${akhwatCandidate.number}</p>
                <p><i class="fas fa-user"></i> <strong>Nama:</strong> ${akhwatCandidate.chairman_name}</p>
                <p><i class="fas fa-graduation-cap"></i> <strong>Kelas:</strong> ${akhwatCandidate.chairman_class}</p>
            </div>
        `;
    }
    
// ============================================
// 7. HANDLE VOTE CONFIRMATION - DIPERBAIKI
// ============================================
async function handleVoteConfirmation() {
    const confirmBtn = document.getElementById('confirmVote');
    const cancelBtn = document.getElementById('cancelVote');
    
    const originalText = confirmBtn.innerHTML;
    const cancelOriginalText = cancelBtn.innerHTML;
    
    confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> MEMPROSES...';
    confirmBtn.disabled = true;
    cancelBtn.disabled = true;
    
    try {
        console.log('ðŸŽ¯ Starting vote process...');
        
        // Validasi data
        if (!selectedIkhwan || !selectedAkhwat) {
            throw new Error('Pilihan tidak lengkap');
        }
        
        const ikhwanCandidate = candidates.find(c => c.id === selectedIkhwan);
        const akhwatCandidate = candidates.find(c => c.id === selectedAkhwat);
        
        if (!ikhwanCandidate || !akhwatCandidate) {
            throw new Error('Kandidat tidak ditemukan');
        }
        
        console.log('ðŸ“ Vote data:', {
            ikhwan: ikhwanCandidate.chairman_name,
            akhwat: akhwatCandidate.chairman_name,
            voter: currentVoter.name
        });
        
        // SIMPAN KE DATABASE JIKA ADA
        if (window.db && window.db.incrementCandidateVotes) {
            try {
                console.log('ðŸ’¾ Saving to database...');
                
                // Update candidate votes
                await window.db.incrementCandidateVotes(selectedIkhwan);
                await window.db.incrementCandidateVotes(selectedAkhwat);
                
                // Record vote transaction
                await window.db.recordVote({
                    voter_id: currentVoter.id,
                    voter_name: currentVoter.name,
                    voter_class: currentVoter.class,
                    voter_username: currentVoter.username,
                    ikhwan_candidate_id: selectedIkhwan,
                    ikhwan_candidate_name: ikhwanCandidate.chairman_name,
                    ikhwat_candidate_number: ikhwanCandidate.number,
                    akhwat_candidate_id: selectedAkhwat,
                    akhwat_candidate_name: akhwatCandidate.chairman_name,
                    akhwat_candidate_number: akhwatCandidate.number
                });
                
                // Update voter status
                if (window.db.updateVoter) {
                    await window.db.updateVoter(currentVoter.id, {
                        has_voted: true,
                        vote_ikhwan_id: selectedIkhwan,
                        vote_akhwat_id: selectedAkhwat,
                        vote_time: new Date().toISOString()
                    });
                }
                
                console.log('âœ… Vote saved to database');
                
            } catch (dbError) {
                console.error('âŒ Database error:', dbError);
                console.log('ðŸ“‹ Falling back to localStorage...');
            }
        }
        
        // SIMPAN KE LOCALSTORAGE (FALLBACK)
        console.log('ðŸ’¾ Saving to localStorage...');
        
        // 1. Simpan vote data
        const voteData = {
            id: Date.now(),
            voter_id: currentVoter.id,
            voter_name: currentVoter.name,
            voter_class: currentVoter.class,
            voter_username: currentVoter.username,
            ikhwan_candidate_id: selectedIkhwan,
            ikhwan_candidate_name: ikhwanCandidate.chairman_name,
            ikhwan_candidate_number: ikhwanCandidate.number,
            akhwat_candidate_id: selectedAkhwat,
            akhwat_candidate_name: akhwatCandidate.chairman_name,
            akhwat_candidate_number: akhwatCandidate.number,
            timestamp: new Date().toISOString()
        };
        
        // Simpan ke localStorage votes
        const votes = JSON.parse(localStorage.getItem('votes') || '[]');
        votes.push(voteData);
        localStorage.setItem('votes', JSON.stringify(votes));
        
        // 2. Simpan untuk admin dashboard
        const adminVotes = JSON.parse(localStorage.getItem('admin_votes') || '[]');
        adminVotes.push(voteData);
        localStorage.setItem('admin_votes', JSON.stringify(adminVotes));
        
        // 3. Update candidate votes count di localStorage
        updateLocalStorageCandidateVotes(selectedIkhwan);
        updateLocalStorageCandidateVotes(selectedAkhwat);
        
        // 4. Update vote count
        const voteCount = parseInt(localStorage.getItem('vote_count') || '0') + 1;
        localStorage.setItem('vote_count', voteCount.toString());
        
        // 5. Set last vote timestamp untuk real-time
        localStorage.setItem('last_vote_timestamp', Date.now().toString());
        localStorage.setItem('last_vote_data', JSON.stringify(voteData));
        
        // UPDATE SESSION
        currentVoter.has_voted = true;
        currentVoter.vote_ikhwan_id = selectedIkhwan;
        currentVoter.vote_akhwat_id = selectedAkhwat;
        currentVoter.vote_time = new Date().toISOString();
        sessionStorage.setItem('currentVoter', JSON.stringify(currentVoter));
        
        // UPDATE CANDIDATE ARRAY
        candidates.forEach(candidate => {
            if (candidate.id === selectedIkhwan || candidate.id === selectedAkhwat) {
                candidate.votes = (candidate.votes || 0) + 1;
            }
        });
        
        // SHOW SUCCESS
        setTimeout(() => {
            document.getElementById('confirmModal').style.display = 'none';
            showSuccessModal();
            disableVoteButtons();
            
            // TRIGGER REAL-TIME UPDATE
            triggerRealTimeUpdate(voteData);
            
            console.log('âœ… Vote completed successfully');
        }, 500);
        
    } catch (error) {
        console.error('âŒ Vote error:', error);
        alert('Gagal menyimpan pilihan: ' + error.message);
        
        confirmBtn.innerHTML = originalText;
        confirmBtn.disabled = false;
        cancelBtn.innerHTML = cancelOriginalText;
        cancelBtn.disabled = false;
    }
}

// ============================================
// FUNGSI BANTUAN
// ============================================

function updateLocalStorageCandidateVotes(candidateId) {
    // Get candidates from localStorage or create default
    let storedCandidates = JSON.parse(localStorage.getItem('candidates') || '[]');
    
    if (storedCandidates.length === 0) {
        // Create default candidates
        storedCandidates = candidates.map(c => ({
            id: c.id,
            number: c.number,
            gender: c.gender,
            chairman_name: c.chairman_name,
            chairman_class: c.chairman_class,
            votes: 0
        }));
    }
    
    // Find and update candidate
    const candidateIndex = storedCandidates.findIndex(c => c.id === candidateId);
    if (candidateIndex !== -1) {
        storedCandidates[candidateIndex].votes = (storedCandidates[candidateIndex].votes || 0) + 1;
    } else {
        // Add new candidate if not found
        const candidate = candidates.find(c => c.id === candidateId);
        if (candidate) {
            storedCandidates.push({
                id: candidate.id,
                number: candidate.number,
                gender: candidate.gender,
                chairman_name: candidate.chairman_name,
                chairman_class: candidate.chairman_class,
                votes: 1
            });
        }
    }
    
    localStorage.setItem('candidates', JSON.stringify(storedCandidates));
}

function triggerRealTimeUpdate(voteData) {
    console.log('ðŸ“¢ Sending real-time update...');
    
    // Method 1: Custom event (works within same browser window)
    const voteEvent = new CustomEvent('newVoteSubmitted', {
        detail: voteData
    });
    window.dispatchEvent(voteEvent);
    
    // Method 2: localStorage polling (works across tabs)
    localStorage.setItem('latest_vote', JSON.stringify(voteData));
    localStorage.setItem('vote_update_trigger', Date.now().toString());
    
    // Method 3: Broadcast Channel API (modern browsers)
    if ('BroadcastChannel' in window) {
        try {
            const voteChannel = new BroadcastChannel('vote_updates');
            voteChannel.postMessage({
                type: 'new_vote',
                data: voteData,
                timestamp: Date.now()
            });
            console.log('ðŸ“¡ Broadcast sent via BroadcastChannel');
        } catch (e) {
            console.log('âš ï¸ BroadcastChannel not supported');
        }
    }
}

// ============================================
// LOAD CANDIDATES - DIPERBAIKI
// ============================================
async function loadCandidates() {
    console.log("ðŸ”„ Loading candidates...");
    
    // Coba dapatkan dari database
    if (window.db && window.db.getAllCandidates) {
        try {
            const dbCandidates = await window.db.getAllCandidates();
            if (dbCandidates && dbCandidates.length > 0) {
                candidates = dbCandidates;
                console.log("âœ… Candidates loaded from database:", candidates.length);
                renderAllCandidates();
                return true;
            }
        } catch (error) {
            console.log("âš ï¸ Could not load from database:", error.message);
        }
    }
    
    // Jika database kosong atau error, gunakan data lokal
    candidates = [
        {
            id: 1, number: 1, gender: 'ikhwan',
            chairman_name: "MUHAMAD FADLAN ARFANI",
            chairman_class: "XI C",
            motto: "Bersama Membangun Prestasi",
            tags: ["#Ganteng", "#Prestasi", "#Loyalitas"],
            vision: "Mewujudkan OSSIP yang inovatif, aspiratif, dan berprestasi...",
            image_chairman: "assets/kandidat1.jpg",
            votes: 0
        },
        {
            id: 2, number: 2, gender: 'ikhwan',
            chairman_name: "PRAMUDITA AULADI",
            chairman_class: "XI C",
            motto: "Kreatif, Inovatif, dan Kolaboratif",
            tags: ["#Kreatif", "#Kolaborasi", "#Aspiratif"],
            vision: "Menjadikan OSSIP sebagai wadah pengembangan potensi siswa...",
            image_chairman: "assets/kandidat2.jpg",
            votes: 0
        },
        {
            id: 3, number: 3, gender: 'ikhwan',
            chairman_name: "DARMA ALIF SAPUTRA",
            chairman_class: "XI D",
            motto: "Satu untuk Semua, Semua untuk Satu",
            tags: ["#Solidaritas", "#Transparan", "#Fleksibel"],
            vision: "Membentuk OSIS yang solid, transparan, dan berorientasi...",
            image_chairman: "assets/kandidat3.png",
            votes: 0
        },
        {
            id: 4, number: 1, gender: 'akhwat',
            chairman_name: "AMRELINA",
            chairman_class: "XI B",
            motto: "Kreatif, Inovatif, dan Bertanggung Jawab",
            tags: ["#Kreatif", "#Disiplin", "#AkhlakBaik"],
            vision: "Menjadikan organisasi santri Insan Pratama 2 sebagai organisasi...",
            image_chairman: "assets/kandidat4.jpg",
            votes: 0
        },
        {
            id: 5, number: 2, gender: 'akhwat',
            chairman_name: "KHOLIDAH IZZATI",
            chairman_class: "XI B",
            motto: "Harmonis, Kreatif, dan Bersama",
            tags: ["#Harmonis", "#Kreatif", "#Kebersamaan"],
            vision: "Mewujudkan lingkungan SMA Insan Pratama yang harmonis...",
            image_chairman: "assets/kandidat5.jpg",
            votes: 0
        },
        {
            id: 6, number: 3, gender: 'akhwat',
            chairman_name: "NAVA AISILA HASNA",
            chairman_class: "XI B",
            motto: "Religius, Aktif, Disiplin, dan Berakhlak Mulia",
            tags: ["#Religius", "#Aktif", "#Disiplin"],
            vision: "Mewujudkan OSSIP Insan Pratama 2 sebagai wadah penggerak...",
            image_chairman: "assets/kandidat6.jpg",
            votes: 0
        }
    ];
    
    console.log("âœ… Local candidates loaded:", candidates.length);
    renderAllCandidates();
    
    // Coba simpan ke database
    if (window.db && window.db.addCandidate) {
        setTimeout(async () => {
            for (const candidate of candidates) {
                try {
                    await window.db.addCandidate(candidate);
                } catch (error) {
                    // Candidate mungkin sudah ada
                }
            }
        }, 1000);
    }
    
    return true;
}
    // ============================================
    // 8. TRIGGER REAL-TIME UPDATE UNTUK ADMIN
    // ============================================
    function triggerRealTimeUpdate() {
        // Method 1: Custom event
        const voteEvent = new CustomEvent('newVoteSubmitted', {
            detail: {
                voterId: currentVoter.id,
                timestamp: new Date().toISOString(),
                ikhwanCandidate: selectedIkhwan,
                akhwatCandidate: selectedAkhwat
            }
        });
        window.dispatchEvent(voteEvent);
        
        // Method 2: localStorage untuk polling
        const voteData = {
            id: Date.now(),
            voter_name: currentVoter.name,
            voter_class: currentVoter.class,
            ikhwan_candidate_id: selectedIkhwan,
            akhwat_candidate_id: selectedAkhwat,
            timestamp: new Date().toISOString()
        };
        
        // Simpan untuk admin dashboard
        const adminVotes = JSON.parse(localStorage.getItem('admin_votes') || '[]');
        adminVotes.push(voteData);
        localStorage.setItem('admin_votes', JSON.stringify(adminVotes));
        
        // Simpan timestamp terakhir untuk polling
        localStorage.setItem('last_vote_timestamp', Date.now().toString());
        
        console.log('ðŸ“¢ Real-time update sent to admin');
    }
    
    // ============================================
    // 9. SHOW SUCCESS MODAL
    // ============================================
    function showSuccessModal() {
        const ikhwanCandidate = candidates.find(c => c.id === selectedIkhwan);
        const akhwatCandidate = candidates.find(c => c.id === selectedAkhwat);
        
        document.getElementById('voterNameSuccess').textContent = currentVoter.name;
        document.getElementById('voterUsernameSuccess').textContent = currentVoter.username;
        
        const voteTime = new Date();
        document.getElementById('voteTimeSuccess').textContent = voteTime.toLocaleString('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        document.getElementById('voteIkhwanSuccess').textContent = 
            `Kandidat ${ikhwanCandidate.number}: ${ikhwanCandidate.chairman_name}`;
        
        document.getElementById('voteAkhwatSuccess').textContent = 
            `Kandidat ${akhwatCandidate.number}: ${akhwatCandidate.chairman_name}`;
        
        document.getElementById('successModal').style.display = 'flex';
    }
    
    // ============================================
    // 10. DISABLE VOTE BUTTONS
    // ============================================
    function disableVoteButtons() {
        document.querySelectorAll('.vote-btn').forEach(button => {
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-check-circle"></i> SUDAH MEMILIH';
            button.style.background = '#95a5a6';
        });
        
        const submitBtn = document.getElementById('submitVote');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> SUDAH MEMILIH';
        submitBtn.style.background = '#95a5a6';
    }
    
    // ============================================
    // 11. CHECK USER SESSION
    // ============================================
    function checkUserSession() {
        const voterData = sessionStorage.getItem('currentVoter');
        
        if (!voterData) {
            alert('Anda belum login. Silakan login terlebih dahulu.');
            window.location.href = 'login.html';
            return false;
        }
        
        try {
            currentVoter = JSON.parse(voterData);
            console.log("âœ… User session:", currentVoter.name);
            
            document.getElementById('currentUser').textContent = currentVoter.name;
            document.getElementById('currentUserClass').textContent = currentVoter.class;
            
            return true;
        } catch (error) {
            console.error("âŒ Invalid session:", error);
            window.location.href = 'login.html';
            return false;
        }
    }
    
    // ============================================
    // 12. SETUP GENDER TABS
    // ============================================
    function setupGenderTabs() {
        document.querySelectorAll('.gender-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const gender = this.getAttribute('data-gender');
                
                document.querySelectorAll('.gender-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.getElementById('ikhwanCandidates').style.display = 
                    gender === 'ikhwan' ? 'block' : 'none';
                document.getElementById('akhwatCandidates').style.display = 
                    gender === 'akhwat' ? 'block' : 'none';
            });
        });
    }
    
    // ============================================
    // 13. SAVE CANDIDATES TO DATABASE
    // ============================================
    async function saveCandidatesToDatabase() {
        if (!window.db || !window.db.addCandidate) return;
        
        console.log("ðŸ’¾ Saving candidates to database...");
        
        for (const candidate of candidates) {
            try {
                const existing = await window.db.getCandidate(candidate.id);
                if (!existing) {
                    await window.db.addCandidate(candidate);
                }
            } catch (error) {
                console.log(`âš ï¸ Could not save candidate:`, error.message);
            }
        }
    }
    
    // ============================================
    // 14. SHOW ALREADY VOTED MODAL
    // ============================================
    function showAlreadyVotedModal() {
        document.getElementById('voterNameAlready').textContent = currentVoter.name;
        document.getElementById('voterUsernameAlready').textContent = currentVoter.username;
        document.getElementById('voterClassAlready').textContent = currentVoter.class;
        document.getElementById('alreadyVotedModal').style.display = 'flex';
    }
    
    // ============================================
    // 15. INITIALIZE APPLICATION
    // ============================================
    async function initializeApp() {
        console.log("ðŸš€ Initializing voting application...");
        
        if (!checkUserSession()) return;
        
        setupGenderTabs();
        await loadCandidates();
        
        if (currentVoter.has_voted) {
            console.log("âš ï¸ User already voted");
            disableVoteButtons();
            showAlreadyVotedModal();
            
            if (currentVoter.vote_ikhwan_id) {
                selectedIkhwan = currentVoter.vote_ikhwan_id;
            }
            if (currentVoter.vote_akhwat_id) {
                selectedAkhwat = currentVoter.vote_akhwat_id;
            }
            
            updateSelectionSummary();
            document.getElementById('selectionSummary').style.display = 'block';
        }
        
        isInitialized = true;
        console.log("âœ… Voting application ready!");
    }
    
    // ============================================
    // 16. SETUP EVENT LISTENERS
    // ============================================
    function setupEventListeners() {
        // Submit vote
        document.getElementById('submitVote').addEventListener('click', function() {
            if (!selectedIkhwan || !selectedAkhwat) {
                alert('Silakan pilih satu kandidat ikhwan dan satu kandidat akhwat!');
                return;
            }
            
            updateConfirmationModal();
            document.getElementById('confirmModal').style.display = 'flex';
        });
        
        // Confirm vote
        document.getElementById('confirmVote').addEventListener('click', handleVoteConfirmation);
        
        // Modal controls
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('confirmModal').style.display = 'none';
        });
        
        document.getElementById('cancelVote').addEventListener('click', () => {
            document.getElementById('confirmModal').style.display = 'none';
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('Keluar dari sistem voting?')) {
                sessionStorage.removeItem('currentVoter');
                window.location.href = 'login.html';
            }
        });
        
        // Finish buttons
        document.getElementById('finishBtn').addEventListener('click', () => {
            window.location.href = 'index.html';
        });
        
        document.getElementById('backToHomeBtn').addEventListener('click', () => {
            window.location.href = 'index.html';
        });
    }
    
    // ============================================
    // 17. START APPLICATION
    // ============================================
    async function startApplication() {
        console.log("â³ Starting application...");
        
        try {
            await initializeApp();
            setupEventListeners();
        } catch (error) {
            console.error("âŒ Application failed to start:", error);
            alert('Gagal memuat aplikasi. Silakan refresh halaman.');
        }
    }
    
    // Mulai aplikasi
    startApplication();
});
</script>
    <script src="database.js"></script>
</body>
</html>